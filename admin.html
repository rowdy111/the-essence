<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Essence | Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  background: #000;
  color: #fff;
  display: flex;
  height: 100vh;
}

/* LEFT USER LIST */
#user-list {
  width: 260px;
  background: #0d0d0d;
  border-right: 2px solid #ff2e4c;
  overflow-y: auto;
}

#user-list h2 {
  text-align: center;
  padding: 20px;
  border-bottom: 2px solid #ff2e4c;
  margin: 0;
  font-size: 20px;
}

.user-item {
  padding: 15px;
  border-bottom: 1px solid #222;
  cursor: pointer;
  transition: 0.2s;
}

.user-item:hover {
  background: #ff2e4c33;
}

/* RIGHT CHAT AREA */
#chat-area {
  flex: 1;
  display: flex;
  flex-direction: column;
}

#chat-header {
  padding: 20px;
  font-size: 18px;
  font-weight: 600;
  border-bottom: 2px solid #ff2e4c;
}

#messages {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

/* Message bubbles */
.msg {
  max-width: 70%;
  padding: 10px 14px;
  margin: 10px 0;
  border-radius: 12px;
  font-size: 14px;
}

.client {
  background: #ff2e4c;
  margin-left: auto;
  color: #fff;
  border-bottom-right-radius: 0;
}

.admin {
  background: #222;
  margin-right: auto;
  color: #fff;
  border-bottom-left-radius: 0;
}

/* INPUT AREA */
#input-area {
  display: flex;
  padding: 15px;
  border-top: 2px solid #ff2e4c;
  background: #0d0d0d;
}

#admin-msg {
  flex: 1;
  padding: 12px;
  border-radius: 8px;
  border: none;
  outline: none;
  font-size: 14px;
}

#send {
  padding: 12px 22px;
  margin-left: 10px;
  background: #ff2e4c;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s;
}

#send:hover {
  background: #ff3f5c;
}
</style>
</head>
<body>

<!-- LEFT SIDE: USERS -->
<div id="user-list">
  <h2>Users</h2>
  <div id="users"></div>
</div>

<!-- RIGHT: CHAT -->
<div id="chat-area">
  <div id="chat-header">Select a user</div>
  <div id="messages"></div>

  <div id="input-area">
    <input type="text" id="admin-msg" placeholder="Type reply..." />
    <button id="send">Send</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-database-compat.js"></script>

<script>
// Your Firebase Setup
const firebaseConfig = {
  apiKey: "AIzaSyBwEIiGPtOKWatNnYuIWzmZe3yUQgLAhxc",
  authDomain: "theessencechat.firebaseapp.com",
  databaseURL: "https://theessencechat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "theessencechat",
  storageBucket: "theessencechat.firebasestorage.app",
  messagingSenderId: "704836914944",
  appId: "1:704836914944:web:a359fa74bdecbf0c212de5"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let selectedUser = null;

// Load users
db.ref("messages").on("value", (snap) => {
  let users = snap.val();
  let userList = document.getElementById("users");
  userList.innerHTML = "";

  for (let id in users) {
    let div = document.createElement("div");
    div.className = "user-item";
    div.textContent = id;
    div.onclick = () => openChat(id);
    userList.appendChild(div);
  }
});

// Open a user's chat
function openChat(id) {
  selectedUser = id;
  document.getElementById("chat-header").textContent = "Chat with: " + id;

  loadMessages();
}

// Load messages for selected user
function loadMessages() {
  if (!selectedUser) return;

  let msgBox = document.getElementById("messages");
  msgBox.innerHTML = "";

  db.ref("messages/" + selectedUser).on("child_added", (snap) => {
    let m = snap.val();
    let bubble = document.createElement("div");

    bubble.className = "msg " + (m.user === "admin" ? "admin" : "client");
    bubble.textContent = m.text;

    msgBox.appendChild(bubble);
    msgBox.scrollTop = msgBox.scrollHeight;
  });
}

// Send admin message
document.getElementById("send").onclick = () => {
  let text = document.getElementById("admin-msg").value;
  if (text.trim() === "" || !selectedUser) return;

  db.ref("messages/" + selectedUser).push({
    text: text,
    time: Date.now(),
    user: "admin"
  });

  document.getElementById("admin-msg").value = "";
};
</script>

</body>
</html>

